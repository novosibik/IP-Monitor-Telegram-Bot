# IP Monitor Telegram Bot

–ú–æ–Ω–∏—Ç–æ—Ä –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ IP/—Ö–æ—Å—Ç–æ–≤ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ Telegram, –æ—Ç—á—ë—Ç–∞–º–∏ (CSV/PNG/PDF), —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞, –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –º–∞—Å—Ç–µ—Ä–∞–º–∏, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–º–∏ –∏ —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∞ —Ç–∞–∫–∂–µ Prometheus-–º–µ—Ç—Ä–∏–∫–∞–º–∏.

> –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Linux (Ubuntu 24.04+ –∏ Ubuntu 25.10). –ü–∏–Ω–≥ –∫–∞–∂–¥—ã–µ `N` —Å–µ–∫—É–Ω–¥, –∞–Ω—Ç–∏-—Ñ–ª–∞–ø–ø–µ—Ä, –∞–ª–µ—Ä—Ç—ã ¬´–ø–∞–¥–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ¬ª, –æ—Ç—á—ë—Ç—ã –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (daily/weekly/monthly) *per-user* —Å —É—á—ë—Ç–æ–º –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞.

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* üîÑ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏**: ICMP `ping` —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 —Å–µ–∫).
* üßØ **–ê–Ω—Ç–∏-—Ñ–ª–∞–ø–ø–µ—Ä**: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ `WARN_TH` –ø–æ–¥—Ä—è–¥ FAIL, ¬´–ø–∞–¥–µ–Ω–∏–µ¬ª –ø–æ—Å–ª–µ `CRIT_TH`, ¬´–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ¬ª –ø–æ—Å–ª–µ `SUCC_TH`.
* üîî **Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –ø–∞–¥–µ–Ω–∏–µ, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (—Å –≤—Ä–µ–º–µ–Ω–µ–º –Ω–∞—á–∞–ª–∞/–∫–æ–Ω—Ü–∞ –∏ –æ–±—â–µ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é), –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è.
* üë• **–†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞**:

  * `admin`/`user`;
  * –¥–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º (–ø–æ IP/Name);
  * –≤—ã–¥–∞—á–∞/–æ—Ç–∑—ã–≤ –ø—Ä–∞–≤ –ø–æ **–Ω–æ–º–µ—Ä–∞–º —Ä–µ—Å—É—Ä—Å–æ–≤**.
* üó£ **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Å—Ç–µ—Ä–∞**: –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ‚Üí –¥–∏–∞–ª–æ–≥ (—à–∞–≥–∏, `/back`, `/cancel`, –∞–≤—Ç–æ-—Ç–∞–π–º–∞—É—Ç).
* üìä **–û—Ç—á—ë—Ç—ã**: CSV/PNG/PDF, —Å—Ä–µ–¥–Ω–∏–π SLA, –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π **—á–∞—Å–æ–≤–æ–π –ø–æ—è—Å** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —É—á—ë—Ç **—Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤**.
* üïí **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –æ—Ç—á—ë—Ç–æ–≤**: daily/weekly/monthly, –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏.
* üß≠ **–ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞ per-user**: –æ—Ç—á—ë—Ç—ã –∏ cron –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º TZ.
* üîÅ **/rebuildcron**: –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ cron –ø—Ä—è–º–æ –∏–∑ —á–∞—Ç–∞ (admin).
* üìà **Prometheus-–º–µ—Ç—Ä–∏–∫–∏**: `ip_up`, streak-–∏ —É—Å–ø–µ—Ö–æ–≤/–Ω–µ—É–¥–∞—á.
* üóÉ **–§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**: `config.json`, `targets.csv`.

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
ip-monitor/
‚îú‚îÄ monitor.py               # –¥–µ–º–æ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ Telegram-–±–æ—Ç
‚îú‚îÄ report.py                # –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç—á—ë—Ç–æ–≤ (CSV/PNG/PDF) —Å TZ per-user
‚îú‚îÄ install_monitor.sh       # —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, systemd, cron
‚îú‚îÄ ip-monitor.service       # –ø—Ä–∏–º–µ—Ä systemd unit (–æ–±—ã—á–Ω–æ –Ω–µ –Ω—É–∂–µ–Ω)
‚îú‚îÄ requirements.txt         # Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ config.json              # –∫–æ–Ω—Ñ–∏–≥ (TOKEN, –ø–æ–ª—É—á–∞—Ç–µ–ª–∏, –ø–æ—Ä–æ–≥–∏, –∏ —Ç.–¥.)
‚îú‚îÄ targets.csv              # —Å–ø–∏—Å–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤: IP;Name;SLA_Target
‚îî‚îÄ reports/                 # –ø–∞–ø–∫–∞ –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
git clone https://github.com/novosibik/ip-monitor.git
cd ip-monitor

# 1) –£–∫–∞–∂–∏—Ç–µ Telegram BOT TOKEN (–æ—Ç @BotFather) –≤ config.json
# 2) –ó–∞–ø–æ–ª–Ω–∏—Ç–µ recipients/targets –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

chmod +x install_monitor.sh
sudo ./install_monitor.sh
```

–°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ Ubuntu 24.04/25.10: –æ–Ω —Å—Ç–∞–≤–∏—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (python3-venv, iputils-ping, —à—Ä–∏—Ñ—Ç—ã –¥–ª—è matplotlib),
—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ `~/ip-monitor` –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç `systemd` unit `ip-monitor@<user>.service`. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ –ø–µ—Ä–µ—Ç–∏—Ä–∞–µ—Ç
`config.json`/`targets.csv`, –æ—Ç—á—ë—Ç—ã –∏ –ª–æ–≥–∏ ‚Äî –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –±–µ–∑ —Ä–∏—Å–∫–∞ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ.

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
systemctl status ip-monitor@"$(whoami)"
crontab -l         # —É–≤–∏–¥–∏—Ç–µ –±–ª–æ–∫ –º–µ–∂–¥—É "# BEGIN ip-monitor reports" ... "# END ..."
```

### üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Ubuntu 25.10

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–æ —Å—Ç–∞—Ä—Ç–∞ –±–æ—Ç–∞:

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å—Ç–∞–≤—è—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫:
   ```bash
   sudo apt-get update
   sudo apt-get install -y python3-venv python3-pip iputils-ping cron tzdata rsync fonts-dejavu-core libcairo2-dev libfreetype6-dev pkg-config
   ```
2. –°–æ–±–µ—Ä–∏—Ç–µ –±–∞–π—Ç–∫–æ–¥ –¥–ª—è –æ–±–æ–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –±–µ–∑ Telegram-—Ç–æ–∫–µ–Ω–∞):
   ```bash
   python3 -m compileall monitor.py report.py
   ```
3. –ü—Ä–æ–≥–æ–Ω–∏—Ç–µ –æ–¥–∏–Ω–æ—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø–∏–Ω–≥–∞ (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞, —Ç.–∫. Telegram-–ø–æ–ª–ª–∏–Ω–≥ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è):
   ```bash
   python3 monitor.py --once
   ```
   –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å–æ–∑–¥–∞–¥—É—Ç—Å—è `ip_monitor_log.csv` –∏ `ip_monitor.prom` ‚Äî —Ç–∞–∫ –º–æ–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ –ø–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç.

–í —á–∞—Ç–µ —Å –±–æ—Ç–æ–º:
`/whoami` ‚Üí –ø–æ–ª—É—á–∏—Ç–µ —Å–≤–æ–π `chat_id`.
–ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –æ—Ç—á—ë—Ç–∞–º–∏ (—Å–º. –Ω–∏–∂–µ).

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### `config.json` (–ø—Ä–∏–º–µ—Ä)

```json
{
  "telegram_token": "PUT_YOUR_BOT_TOKEN_HERE",
  "recipients": [
    {
      "chat_id": "123456789",
      "role": "admin",
      "resources": "*",
      "timezone": "Europe/Moscow",
      "reports": {
        "daily":   { "enabled": true,  "hour": 9,  "minute": 0 },
        "weekly":  { "enabled": true,  "hour": 10, "minute": 0, "dow": 1 },
        "monthly": { "enabled": false, "hour": 9,  "minute": 30, "day": 1 }
      }
    }
  ],
  "check_interval": 30,
  "log_csv": "ip_monitor_log.csv",
  "reports_dir": "reports",
  "warn_threshold": 1,
  "fail_threshold": 3,
  "success_threshold": 2,
  "sla_target_percent": 99.9,
  "timezone": "UTC",
  "working_hours": { "enabled": false, "start": "09:00", "end": "21:00" },
  "prom_metrics_path": "ip_monitor.prom",
  "session_timeout_minutes": 15
}
```

**–ü–æ—è—Å–Ω–µ–Ω–∏—è:**

* `recipients` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. `resources` –º–æ–∂–µ—Ç –±—ã—Ç—å `"*"` (–¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ü–µ–ª—è–º) –∏–ª–∏ –º–∞—Å—Å–∏–≤–æ–º –∏–º–µ–Ω/IP –∏–∑ `targets.csv`.
* –ü–µ—Ä–∏–æ–¥—ã –æ—Ç—á—ë—Ç–æ–≤: `daily`/`weekly`/`monthly`. –î–ª—è weekly —É–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–Ω—è –Ω–µ–¥–µ–ª–∏ (`dow`, 1=–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫), –¥–ª—è monthly ‚Äî –Ω–æ–º–µ—Ä –¥–Ω—è –º–µ—Å—è—Ü–∞ (`day`).
* –ü–æ—Ä–æ–≥–∏ `warn_threshold`/`fail_threshold`/`success_threshold` —É–ø—Ä–∞–≤–ª—è—é—Ç –∞–Ω—Ç–∏-—Ñ–ª–∞–ø–ø–µ—Ä–æ–º, `check_interval` ‚Äî –ø–µ—Ä–∏–æ–¥ ICMP-–ø—Ä–æ–≤–µ—Ä–æ–∫.
* –ü—É—Ç–∏ `log_csv`, `reports_dir`, `prom_metrics_path` –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–∏—Å–∞—Ç—å –≤ –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ.
* `working_hours.enabled=true` –≤–∫–ª—é—á–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ä–∞–±–æ—á–µ–º—É –≤—Ä–µ–º–µ–Ω–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Ç—á—ë—Ç–∞—Ö).
* `session_timeout_minutes` –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Å—Ç–µ—Ä–∞—Ö Telegram-–±–æ—Ç–∞.

### `targets.csv`

–§–æ—Ä–º–∞—Ç CSV —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º `;`:

```
IP;Name;SLA_Target
8.8.8.8;Google DNS;99.9
1.1.1.1;Cloudflare DNS;99.9
```

–ü–æ–ª–µ `SLA_Target` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ –≤ –æ—Ç—á—ë—Ç–∞—Ö –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π SLA.

### –°–ª—É–∂–±–∞ –∏ cron

* systemd-unit —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ `ip-monitor@<user>.service` –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `monitor.py` –∏–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `~/ip-monitor/.venv`.
* –ö–æ–º–∞–Ω–¥–∞ `/rebuildcron` (–¥–ª—è —Ä–æ–ª–∏ admin) –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç cron-–∑–∞–¥–∞–Ω–∏—è –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–ª–æ–∫–æ–≤ `reports` –≤ `config.json`.
* –õ–æ–≥–∏ –ø–∏–Ω–≥–æ–≤ (`ip_monitor_log.csv`) –∏ –º–µ—Ç—Ä–∏–∫–∏ Prometheus (`ip_monitor.prom`) –ª–µ–∂–∞—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –±–æ—Ç–∞; –æ—Ç—á—ë—Ç—ã —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ `reports/`.

